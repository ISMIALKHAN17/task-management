<div class="globel_wrap">
 <div class="loading_wrap" *ngIf="loading">
  <span class="loader"></span>
 </div>
    <div class="globel_header d-flex justify-content-between align-items-center">
        <h3>Client</h3>
        <button class="theme_btn" (click)="open(addStaff) ; editClient = false;clientForm.reset()"><i class="fas fa-plus"></i> Add </button>
    </div>
    <div class="filter">
      <input type="text" (keyup.enter)="searchTasks()" [(ngModel)]="searchTerm" placeholder="Search">
    </div>
    <div class="table_wrap">
      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th class="pointerC" scope="col" (click)="sortClients('name')">Name</th>
            <th class="pointerC" scope="col" (click)="sortClients('email')">Email</th>
            <th class="pointerC" scope="col" (click)="sortClients('phoneNumber')">Phone number</th>
            <th class="pointerC" scope="col" (click)="sortClients('address')">Address</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let client of clients ; index as i" >
            <td>{{i + 1}}</td>
            <td class="pointerC" (click)="fetchClientTasks(Clienttasks ,client.id )">{{ client.name }}</td>
            <td>{{ client.email }}</td>
            <td>{{ client.phoneNumber }}</td>
            <td>{{ client.address }}</td>
            <td>
              <ul class="actions m-0 d-flex gap-2">
                <li><i class="far fa-eye" (click)="viewClient(addStaff, client)" data-toggle="tooltip" title="View"></i></li>
                <li>
                  <label class="switch">
                    <input (change)="disableClient(client)" [checked]="client.status !== 'Disabled'" type="checkbox">
                    <span class="slider"></span>
                  </label>
                </li>
                <!-- <li><i class="fas fa-trash-alt" (click)="deleteStaff(client.id)" data-toggle="tooltip" title="Delete"></i></li> -->
              </ul>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="pagination d-flex justify-content-center" *ngIf="paginationData.last_page > 1">
      <nav>
        <ul class="pagination justify-content-center" >
          <li class="page-item">
            <a class="page-link" (click)="taskPaginantion(paginationData.current_page-1)"  [ngClass]="{ 'disabled': paginationData.current_page === 1 }" aria-label="First">
              <span aria-hidden="true"><i class="fa-solid fa-chevron-left"></i></span>
            </a>
          </li>
          <li class="page-item"  *ngFor="let item of pagination">
            <a class="page-link" [ngClass]="{'active': paginationData.current_page == item}" (click)="taskPaginantion(item)"  aria-label="First">
              <span aria-hidden="true">{{item}}</span>
            </a>
          </li>
          <li class="page-item">
            <a class="page-link"  (click)="taskPaginantion(paginationData.current_page+1)" [ngClass]="{ 'disabled': paginationData.current_page === paginationData.last_page }"  aria-label="First">
              <span aria-hidden="true"><i class="fa-solid fa-chevron-right"></i></span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
</div>

<ng-template #addStaff let-c="close" let-d="dismiss">
   <div class="addModal">
    <div class="modalHeader d-flex justify-content-between align-items-center">
        <h4 class="m-0">Add Client</h4>
        <i (click)="d('Cross click')" class="far fa-times-circle"></i>
    </div>
   <div class="staffModal">
    <form [formGroup]="clientForm" (ngSubmit)="onSubmit()">
        <div class="row mt-2">


        <div class="col-md-6">
            <div class="form-group mb-2">
          <label for="name">Client Name:</label>
          <input type="text" class="form-control" formControlName="name" [ngClass]="{ 'is-invalid': clientForm.get('name').invalid && clientForm.get('name').touched }">
          <div class="invalid-feedback" *ngIf="clientForm.get('name').errors && clientForm.get('name').touched">
            Client Name is required.
          </div>
        </div>
        </div>



        <div class="col-md-6">
            <div class="form-group mb-2">
          <label for="address">Client Address:</label>
          <input type="text" class="form-control" formControlName="address" [ngClass]="{ 'is-invalid': clientForm.get('address').invalid && clientForm.get('address').touched }">
          <div class="invalid-feedback" *ngIf="clientForm.get('address').errors && clientForm.get('address').touched">
            Client Address is required.
          </div>
        </div>
        </div>

        <div class="col-md-6">
            <div class="form-group mb-2">
          <label for="phoneNumber">Phone Number:</label>
          <input type="text" class="form-control" formControlName="phoneNumber" [ngClass]="{ 'is-invalid': clientForm.get('phoneNumber').invalid && clientForm.get('phoneNumber').touched }">
          <div class="invalid-feedback" *ngIf="clientForm.get('phoneNumber').errors && clientForm.get('phoneNumber').touched">
            Please enter a valid 10-digit phone number.
          </div>
        </div>
        </div>

        <div class="col-md-6">
            <div class="form-group mb-2">
          <label for="email">Email:</label>
          <input type="email" class="form-control" formControlName="email" [ngClass]="{ 'is-invalid': clientForm.get('email').invalid && clientForm.get('email').touched }">
          <div class="invalid-feedback" *ngIf="clientForm.get('email').errors && clientForm.get('email').touched">
            Please enter a valid email address.
          </div>
        </div>
        </div>
        <div class="col-md-12">
            <div class="form-group mb-2">
          <label for="description">Client Description:</label>
          <textarea class="form-control" formControlName="description" [ngClass]="{ 'is-invalid': clientForm.get('description').invalid && clientForm.get('description').touched }"></textarea>
          <div class="invalid-feedback" *ngIf="clientForm.get('description').errors && clientForm.get('description').touched">
            Client Description is required.
          </div>
        </div>
        </div>
    </div>

        <div class="d-flex mt-2 justify-content-end">
            <button type="submit" class="theme_btn">

              <span *ngIf="!editClient">Submit</span>
              <span *ngIf="editClient">Update</span>
            </button>
        </div>
      </form>



   </div>
   </div>
</ng-template>


<ng-template #Clienttasks let-c="close" let-d="dismiss">
  <div class="addModal">
    <div class="modalHeader d-flex justify-content-between align-items-center">
        <h4 class="m-0">Tasks</h4>
        <i (click)="d('Cross click')" class="far fa-times-circle"></i>
    </div>
   <div class="client_tasks">
    <table class="table table-striped" >
      <thead>
        <tr>
          <th scope="col">#</th>
          <th>Name</th>
          <th>Assigned Date</th>
          <th>Due Date</th>
          <th>Description</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngIf="tasks.length > 0; else noResults">
          <tr *ngFor="let task of tasks; index as i">
            <td>{{ i+1 }}</td>
            <td>{{ task.name.length > 10 ? task.name.slice(0, 10) + '...' : task.name }}</td>
            <td>{{ formatDate(task.created_at) }}</td>
            <td>{{ formatDate(task.dueDate) }}</td>
            <td>{{ task.description.length > 20 ? task.description.slice(0, 20) + '...' : task.description }}</td>
            <td>{{ task.status }}</td>
          </tr>
        </ng-container>
        <ng-template #noResults>
          <tr>
            <td colspan="7" class="text-center">No results found.</td>
          </tr>
        </ng-template>
      </tbody>
    </table>
   </div>
    </div>
</ng-template>


